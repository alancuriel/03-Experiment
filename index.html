<script src="https://d3js.org/d3.v6.js"></script>

<style></style>

<body style="font-family: sans-serif;">
    <main id="mainContent" style="
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
    ">


        <div class="viz" id="viz1" style="transform: translateX(100vw);
                   display: flex;
                   flex-direction: column-reverse;
                   justify-content: center;
                   align-items: center;">
            <form name="viz-1" netlify>
                <p style="text-align: center;">
                    Two values are marked with dots. <br> What do you think the percent of the smaller value to the larger value?<br> Please put your answer Below.<br> e.g. If you think the smaller one is exactly a half of the bigger one,<br> please input
                    "50".
                </p>
                <p style="text-align: center;">
                    <label>Answer 
                        <input type="number" name="viz1-reported" />
                        <button type="submit">Send</button>
                    </label>
                </p>
            </form>
        </div>
        <div class="viz" id="viz2" style="transform: translateX(100vw);
                   display: flex;
                   flex-direction: column-reverse;
                   justify-content: center;
                   align-items: center;">
            <form name="viz-2" netlify>
                <p style="text-align: center;">
                    Two values are marked with dots. <br> What do you think the percent of the smaller value to the larger value?<br> Please put your answer Below.<br> e.g. If you think the smaller one is exactly a half of the bigger one,<br> please input
                    "50".
                </p>
                <p style="text-align: center;">
                    <label>Answer 
                        <input type="number" name="viz2-reported" />
                        <button type="submit">Send</button>
                    </label>
                </p>
            </form>
        </div>
        <div class="viz" id="viz3" style="transform: translateX(100vw);
                   display: flex;
                   flex-direction: column-reverse;
                   justify-content: center;
                   align-items: center;">
            <form name="viz-3" netlify>
                <p style="text-align: center;">
                    Two values are marked with dots. <br> What do you think the percent of the smaller value to the larger value?<br> Please put your answer Below.<br> e.g. If you think the smaller one is exactly a half of the bigger one,<br> please input
                    "50".
                </p>
                <p style="text-align: center;">
                    <label>Answer 
                        <input type="number" name="viz3-reported" />
                        <button type="submit">Send</button>
                    </label>
                </p>
            </form>
        </div>

        <div id="complete" style="transform: translateX(100vw);
                   display: flex;
                   flex-direction: column;
                   justify-content: center;
                   align-items: center;
                   width: 500;
                   height: 500;">
            <h1 style="text-align: center;">Thanks for participating</h1>
            <h3>Click <a href="/">here</a> to retake</h3>
        </div>

    </main>
</body>

<script>
    const elements = d3.selectAll(".viz");

    const width = 500;
    const height = 500;

    // Creates an array of size 5-10 with data between 0-100
    const getRandomData = () => {
        let a = new Array(d3.randomInt(5, 11)()).fill(undefined);

        return a.map(d => d3.randomInt(0, 101)());
    }

    /*  PUT CODE HERE */

    const svg1 = d3.create("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "blue");

    const svg2 = d3.create("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "red");


    const svg3 = d3.create("svg")
        .attr("width", width)
        .attr("height", height)
        .style("background", "green");



    /* ^ PUT CODE HERE ^ */

    d3.select("#viz1")
        .append(() => svg1.node());
    d3.select("#viz2")
        .insert(() => svg2.node());
    d3.select("#viz3")
        .insert(() => svg3.node());

    let previousRandom = Math.round(Math.random() * (elements.size() - 1));
    const randomsSelected = [previousRandom];


    const nextRandom = () => {
        if (randomsSelected.length < elements.size()) {
            let r = Math.round(Math.random() * (elements.size() - 1));
            while (randomsSelected.indexOf(r) > -1) {
                r = Math.round(Math.random() * (elements.size() - 1));
            }
            previousRandom = r;
            randomsSelected.push(r);
            return r;
        }
    };

    elements
        .style("transform", (d, i) => {
            return i === previousRandom ? "translate(0)" : "translateX(100vw)";
        })
        .style("position", "absolute")
        .style("transition", "ease-in-out transform 0.7s");

    elements.selectAll("form").on("submit", function(e, i, d) {
        e.preventDefault()
        if (randomsSelected.length < elements.size()) {
            elements
                .filter(function(d, i) {
                    return i === previousRandom;
                })
                .style("transform", "translateX(-100vw)");

            let nextr = nextRandom();

            elements
                .filter(function(d, i) {
                    return i === nextr;
                })
                .style("transform", "translateX(0)");
        } else {

            elements
                .filter(function(d, i) {
                    return i === previousRandom;
                })
                .style("transform", "translateX(-100vw)");

            d3.select("#complete")
                .style("transition", "ease-in-out transform 0.7s")
                .style("transform", "translateX(0)");

        }
    });
</script>